<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPSC Ascent - Current Affairs & Quizzes</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC; /* Light gray background */
            line-height: 1.6;
            color: #333; /* Darker default text for readability */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header - Consistent with index.html -->
    <header class="bg-white shadow-md fixed w-full z-10 py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-extrabold text-[#1A202C]">UPSC</a>
            <nav class="hidden md:block">
                <ul class="flex items-center space-x-8">
                    <li><a href="index.html" class="text-gray-700 hover:text-blue-600 font-medium text-lg transition-colors duration-200">Home</a></li>
                    <li><a href="syllabus.html" class="text-gray-700 hover:text-blue-600 font-medium text-lg transition-colors duration-200">Syllabus</a></li>
                    <li><a href="study-planner.html" class="text-gray-700 hover:text-blue-600 font-medium text-lg transition-colors duration-200">Study Planner</a></li>
                    <li><a href="study-material.html" class="text-gray-700 hover:text-blue-600 font-medium text-lg transition-colors duration-200">Study Material</a></li>
                    <li><a href="current-affairs.html" class="text-blue-600 font-bold text-lg transition-colors duration-200">Current Affairs & Quizzes</a></li>
                    <li><a href="pyqs.html" class="text-gray-700 hover:text-blue-600 font-medium text-lg transition-colors duration-200">PYQs</a></li>
                    <li><a href="answer-writing.html" class="text-gray-700 hover:text-blue-600 font-medium text-lg transition-colors duration-200">Answer Writing</a></li>
                    <li><a href="admin.html" class="bg-blue-600 text-white px-6 py-2 rounded-full font-semibold hover:bg-blue-700 transition-colors duration-200 shadow-md">Admin Login</a></li>
                </ul>
            </nav>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden text-gray-700 focus:outline-none">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
        <!-- Mobile Menu Overlay -->
        <div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-75 z-20 hidden md:hidden">
            <div class="absolute right-0 top-0 h-full w-3/4 bg-white shadow-lg p-6 transform translate-x-full transition-transform duration-300 ease-in-out">
                <button id="close-mobile-menu" class="absolute top-4 right-4 text-gray-700 focus:outline-none">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <ul class="flex flex-col space-y-4 mt-12">
                    <li><a href="index.html" class="block text-gray-800 hover:text-blue-600 font-medium text-xl py-2">Home</a></li>
                    <li><a href="syllabus.html" class="block text-gray-800 hover:text-blue-600 font-medium text-xl py-2">Syllabus</a></li>
                    <li><a href="study-planner.html" class="block text-gray-800 hover:text-blue-600 font-medium text-xl py-2">Study Planner</a></li>
                    <li><a href="study-material.html" class="block text-gray-800 hover:text-blue-600 font-medium text-xl py-2">Study Material</a></li>
                    <li><a href="current-affairs.html" class="block text-gray-800 hover:text-blue-600 font-medium text-xl py-2">Current Affairs & Quizzes</a></li>
                    <li><a href="pyqs.html" class="block text-gray-800 hover:text-blue-600 font-medium text-xl py-2">PYQs</a></li>
                    <li><a href="answer-writing.html" class="block text-gray-800 hover:text-blue-600 font-medium text-xl py-2">Answer Writing</a></li>
                    <li><a href="admin.html" class="block bg-blue-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-blue-700 transition-colors duration-200 shadow-md text-center mt-4">Admin Login</a></li>
                </ul>
            </div>
        </div>
    </header>

    <main class="flex-grow pt-20"> <!-- Added pt-20 to account for fixed header -->
        <section class="container mx-auto px-4 py-8">
            <h1 class="text-4xl font-bold text-center text-gray-800 mb-10">Current Affairs & Quizzes</h1>

            <div id="current-affairs-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Current affairs and quizzes will be loaded here by JS -->
                <p class="text-center text-gray-500 col-span-full py-8">Loading current affairs...</p>
            </div>
        </section>
    </main>

    <!-- Footer - Consistent with index.html -->
    <footer class="bg-gray-800 text-white p-6 text-center mt-12 rounded-t-lg shadow-inner">
        <div class="container mx-auto">
            <p class="mb-2">&copy; 2025 UPSC Ascent. All rights reserved.</p>
            <p class="text-sm opacity-80">Designed for UPSC Aspirants with dedication and precision.</p>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 text-sm">Privacy Policy</a>
                <span class="text-gray-500">|</span>
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 text-sm">Terms of Service</a>
                <span class="text-gray-500">|</span>
                <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200 text-sm">Contact Us</a>
            </div>
        </div>
    </footer>

    <!-- Firebase SDKs and Integrated JavaScript -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, query, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAn0XLw2XA26UBf4OevQkqp5UESakQI8kg",
            authDomain: "upscbuddy-5050d.firebaseapp.com",
            projectId: "upscbuddy-5050d",
            storageBucket: "upscbuddy-5050d.firebasestorage.app",
            messagingSenderId: "632136482996",
            appId: "1:632136482996:web:4bebdeb43c266398d697e1",
            measurementId: "G-QLVRYRJFL2"
        };

        // Global variables for Firebase instances
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const currentAppId = firebaseConfig.appId.split(':')[1]; // Extract appId from the provided config

        // Store unsubscribe functions for real-time listeners to prevent memory leaks
        const unsubscribeFunctions = {};

        // Card Component HTML structure (used by content-loading functions)
        function createCardHtml(item) {
            return `
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 border border-gray-100 transform hover:-translate-y-1 animate-fade-in">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">${item.title || 'No Title'}</h3>
                    ${item.date ? `<p class="text-sm text-gray-500 mb-2">${item.date}</p>` : ''}
                    <p class="text-gray-600 mb-4">${item.description || 'No description available.'}</p>
                    <a href="${item.link || '#'}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium flex items-center">
                        Read More
                        <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                    </a>
                </div>
            `;
        }

        /**
         * Generic function to load content for a given collection using real-time listeners (onSnapshot).
         * @param {string} collectionName - The name of the Firestore collection (e.g., 'currentAffairs').
         * @param {string} containerId - The ID of the HTML element where content will be displayed.
         * @param {number|null} limitCount - Optional. The maximum number of documents to retrieve.
         */
        function loadContent(collectionName, containerId, limitCount = null) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container with ID '${containerId}' not found.`);
                return;
            }

            // If there's an existing listener for this container, unsubscribe it first
            if (unsubscribeFunctions[containerId]) {
                unsubscribeFunctions[containerId]();
                delete unsubscribeFunctions[containerId];
            }

            container.innerHTML = `<p class="text-center text-gray-500 col-span-full py-8">Loading ${collectionName}...</p>`;

            try {
                let q = collection(db, `artifacts/${currentAppId}/public/data/${collectionName}`);
                if (limitCount) {
                    q = query(q, limit(limitCount));
                }

                // Set up the real-time listener
                const unsubscribe = onSnapshot(q, (querySnapshot) => {
                    let htmlContent = '';
                    if (querySnapshot.empty) {
                        htmlContent = `<p class="text-center text-gray-600 text-lg col-span-full py-8">No ${collectionName} available yet. Check back soon!</p>`;
                    } else {
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            htmlContent += createCardHtml(data);
                        });
                    }
                    container.innerHTML = htmlContent;
                }, (error) => {
                    console.error(`Error listening to ${collectionName}:`, error);
                    container.innerHTML = `<p class="text-center text-red-600 text-lg col-span-full py-8">Failed to load ${collectionName}. Please try again later.</p>`;
                    showCustomModal('Error', `Failed to load ${collectionName}. Please check your internet connection or try again later.`, 'error');
                });

                // Store the unsubscribe function
                unsubscribeFunctions[containerId] = unsubscribe;

            } catch (error) {
                console.error(`Error setting up listener for ${collectionName}:`, error);
                container.innerHTML = `<p class="text-center text-red-600 text-lg col-span-full py-8">Failed to initialize ${collectionName} listener. Please try again later.</p>`;
                showCustomModal('Error', `Failed to initialize ${collectionName} listener. Error: ${error.message}`, 'error');
            }
        }

        // Custom modal function (instead of alert/confirm)
        function showCustomModal(title, message, type = 'info', callback = null) {
            const modalId = 'custom-modal-' + Date.now();
            const modalHtml = `
                <div id="${modalId}" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-lg shadow-xl max-w-sm w-full mx-auto p-6 transform transition-all duration-300 scale-95 opacity-0" style="animation: modal-fade-in 0.3s forwards;">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold ${type === 'error' ? 'text-red-600' : 'text-blue-600'}">${title}</h3>
                            <button class="text-gray-500 hover:text-gray-700 close-modal-btn" data-modal-id="${modalId}">&times;</button>
                        </div>
                        <p class="text-gray-700 mb-6">${message}</p>
                        <div class="flex justify-end">
                            <button class="bg-blue-600 text-white px-5 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 close-modal-btn" data-modal-id="${modalId}">OK</button>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes modal-fade-in {
                        from { opacity: 0; transform: scale(0.95); }
                        to { opacity: 1; transform: scale(1); }
                    }
                    @keyframes modal-fade-out {
                        from { opacity: 1; transform: scale(1); }
                        to { opacity: 0; transform: scale(0.95); }
                    }
                </style>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);

            const modalElement = document.getElementById(modalId);
            modalElement.querySelectorAll('.close-modal-btn').forEach(button => {
                button.onclick = () => {
                    modalElement.style.animation = 'modal-fade-out 0.3s forwards';
                    modalElement.addEventListener('animationend', () => modalElement.remove());
                    if (callback) callback();
                };
            });
        }

        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', () => {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const mobileMenu = mobileMenuOverlay.querySelector('div');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenuOverlay.classList.remove('hidden');
                setTimeout(() => {
                    mobileMenu.classList.remove('translate-x-full');
                }, 10); // Small delay to allow display change to register
            });

            closeMobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.add('translate-x-full');
                mobileMenu.addEventListener('transitionend', () => {
                    mobileMenuOverlay.classList.add('hidden');
                }, { once: true });
            });

            // Close mobile menu if a link is clicked
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('translate-x-full');
                    mobileMenu.addEventListener('transitionend', () => {
                        mobileMenuOverlay.classList.add('hidden');
                    }, { once: true });
                });
            });

            // Load content for this specific page
            loadContent('currentAffairs', 'current-affairs-container');
        });
    </script>
</body>
</html>
